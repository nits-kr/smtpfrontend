import{u as k,r as R,y as r,j as s,d as b,R as E,F as x,D as A,e as F,f as P,g as D}from"./index-BNo7UyhZ.js";import{u as S,a as U}from"./campaignsApi-G0B_2bMM.js";import{B as l}from"./Button-2KMl3sSW.js";const T=()=>{var j;const{data:n,isLoading:m,error:a,refetch:h}=S(),[p]=U(),i=k();R.useEffect(()=>{var t;if(a){let e="Failed to load campaigns";(t=a==null?void 0:a.data)!=null&&t.message?e=a.data.message:a!=null&&a.error?e=a.error:(a==null?void 0:a.status)==="FETCH_ERROR"?e="Network error. Please check your connection.":(a==null?void 0:a.status)==="PARSING_ERROR"?e="Error parsing server response.":(a==null?void 0:a.status)===500?e="Server error. Please try again later.":(a==null?void 0:a.status)===404?e="Campaigns endpoint not found.":(a==null?void 0:a.status)===401?e="Unauthorized. Please login again.":(a==null?void 0:a.status)===403&&(e="You do not have permission to view campaigns."),r.error(s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(b,{className:"text-xl"}),s.jsx("span",{children:e})]}),{toastId:"campaigns-error",autoClose:5e3})}},[a,i]);const y=t=>{if(!t)return"N/A";try{const e=new Date(t);return isNaN(e.getTime())?"Invalid Date":e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid Date"}},C=t=>{switch(t){case"active":case"processing":return"bg-green-500/20 text-green-400";case"paused":case"draft":return"bg-yellow-500/20 text-yellow-400";case"completed":return"bg-blue-500/20 text-blue-400";case"failed":return"bg-red-500/20 text-red-400";default:return"bg-slate-700 text-slate-300"}},o=t=>{switch(t){case"processing":return"Processing";case"draft":return"Draft";case"active":return"Active";case"paused":return"Paused";case"completed":return"Completed";case"failed":return"Failed";default:return t||"Unknown"}},d=E.useMemo(()=>n!=null&&n.success&&(n!=null&&n.results)?n.results.map(t=>{var e;return{_id:(t==null?void 0:t._id)||"",name:(t==null?void 0:t.name)||"Unnamed Campaign",subject:(t==null?void 0:t.subject)||"No Subject",status:(t==null?void 0:t.status)||"draft",fromName:(t==null?void 0:t.fromName)||"Unknown",fromEmail:(t==null?void 0:t.fromEmail)||"no-email@example.com",recipientsCount:(t==null?void 0:t.recipientsCount)||((e=t==null?void 0:t.recipients)==null?void 0:e.length)||0,createdAt:t==null?void 0:t.createdAt,updatedAt:t==null?void 0:t.updatedAt}}):[],[n,a]),f=async(t,e)=>{var v;try{await p({id:t,status:e}).unwrap(),r.success(`Campaign status updated to ${o(e)}`),h()}catch(c){let N="Failed to update campaign status";(v=c==null?void 0:c.data)!=null&&v.message&&(N=c.data.message),r.error(N)}},g=[{key:"name",label:"Campaign Name",render:(t,e)=>s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-white",children:(e==null?void 0:e.name)||"Unnamed Campaign"}),s.jsx("div",{className:"text-sm text-slate-400",children:(e==null?void 0:e.subject)||"No Subject"})]})},{key:"from",label:"From",render:(t,e)=>s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",children:(e==null?void 0:e.fromName)||"Unknown"}),s.jsx("div",{className:"text-xs text-slate-400",children:(e==null?void 0:e.fromEmail)||"no-email@example.com"})]})},{key:"status",label:"Status",render:(t,e)=>s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase ${C(e==null?void 0:e.status)}`,children:o(e==null?void 0:e.status)})},{key:"recipientsCount",label:"Recipients",align:"center",render:(t,e)=>s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"font-bold",children:(e==null?void 0:e.recipientsCount)||0}),s.jsx("div",{className:"text-xs text-slate-400",children:"contacts"})]})},{key:"createdAt",label:"Created",render:(t,e)=>y(e==null?void 0:e.createdAt)},{key:"actions",label:"Actions",align:"center",render:(t,e)=>s.jsxs("div",{className:"flex gap-2 justify-center",children:[(e==null?void 0:e.status)==="active"?s.jsx(l,{variant:"secondary",size:"sm",onClick:()=>f(e==null?void 0:e._id,"paused"),title:"Pause Campaign",children:s.jsx(F,{})}):(e==null?void 0:e.status)==="paused"?s.jsx(l,{variant:"primary",size:"sm",onClick:()=>f(e==null?void 0:e._id,"active"),title:"Resume Campaign",children:s.jsx(P,{})}):(e==null?void 0:e.status)==="draft"?s.jsx(l,{variant:"primary",size:"sm",onClick:()=>i(`/campaigns/edit/${e==null?void 0:e._id}`),title:"Edit Campaign",children:"Edit"}):null,s.jsx(l,{variant:"ghost",size:"sm",onClick:()=>i(`/campaigns/${e==null?void 0:e._id}/live`),title:"View Details",children:s.jsx(D,{})})]})}],u=()=>{r.info("Refreshing campaigns..."),h()};return a&&!n?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center bg-slate-800 p-4 rounded-lg border border-slate-700",children:[s.jsx("h1",{className:"text-xl font-bold text-white",children:"Campaigns"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(l,{variant:"secondary",onClick:u,children:"Retry"}),s.jsxs(l,{variant:"primary",onClick:()=>i("/campaigns/new"),children:[s.jsx(x,{className:"mr-2"})," New Campaign"]})]})]}),s.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 shadow-md p-8 text-center",children:[s.jsx(b,{className:"mx-auto text-4xl text-red-500 mb-4"}),s.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Failed to Load Campaigns"}),s.jsx("p",{className:"text-slate-400 mb-6",children:((j=a==null?void 0:a.data)==null?void 0:j.message)||"Unable to connect to the server. Please check your connection."}),s.jsxs("div",{className:"flex gap-4 justify-center",children:[s.jsx(l,{variant:"primary",onClick:u,children:"Try Again"}),s.jsx(l,{variant:"secondary",onClick:()=>i("/dashboard"),children:"Go to Dashboard"})]})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center bg-slate-800 p-4 rounded-lg border border-slate-700",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h1",{className:"text-xl font-bold text-white",children:"Campaigns"}),!m&&d.length>0&&s.jsxs("span",{className:"text-sm text-slate-400",children:[d.length," campaign",d.length!==1?"s":""]})]}),s.jsxs("div",{className:"flex gap-2",children:[a&&n&&s.jsx(l,{variant:"secondary",onClick:u,size:"sm",children:"Refresh"}),s.jsxs(l,{variant:"primary",onClick:()=>i("/campaigns/new"),children:[s.jsx(x,{className:"mr-2"})," New Campaign"]})]})]}),s.jsx("div",{className:"bg-slate-800 rounded-lg border border-slate-700 shadow-md",children:m?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),s.jsx("p",{className:"mt-4 text-slate-400",children:"Loading campaigns..."})]}):d.length>0?s.jsx(A,{columns:g,data:d,searchable:!0}):s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("p",{className:"text-slate-400",children:"No campaigns found. Create your first campaign to get started!"}),s.jsxs(l,{variant:"primary",className:"mt-4",onClick:()=>i("/campaigns/new"),children:[s.jsx(x,{className:"mr-2"})," Create Campaign"]})]})})]})};export{T as default};
